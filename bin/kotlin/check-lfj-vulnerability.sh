#!/bin/bash

SERVICES_FILE=${1-namespaces}

for service in $(cat "$SERVICES_FILE"); do
  echo "Starting checks for $service"
  if [ ! -d "$HOME/git/$service" ]
  then
      git clone "https://github.com/ministryofjustice/$service.git" &> /dev/null
  fi

  {
    cd ~/git/$service || exit
    git checkout main
    git pull
  } &> /dev/null

  echo "Checking lfj vulnerabilities for $service"
  ./gradlew dependencies | grep log4j-core || echo "$service: not directly dependent on log4j-core"

  echo "---------------------------------------------------------------"
done
